<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Safety Coach - Integrated Demo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
        'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
        sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .animate-pulse {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    @keyframes slideDown {
      from {
        transform: translateY(-100%);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .slide-down {
      animation: slideDown 0.3s ease-out;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }

    .shake {
      animation: shake 0.3s ease-in-out;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // UI Components
    const Card = ({ className = '', children, ...props }) => (
      <div className={`rounded-lg border border-slate-200 bg-white shadow-sm ${className}`} {...props}>
        {children}
      </div>
    );

    const CardHeader = ({ className = '', children, ...props }) => (
      <div className={`flex flex-col space-y-1.5 p-6 ${className}`} {...props}>
        {children}
      </div>
    );

    const CardTitle = ({ className = '', children, ...props }) => (
      <h3 className={`text-2xl font-semibold leading-none tracking-tight ${className}`} {...props}>
        {children}
      </h3>
    );

    const CardContent = ({ className = '', children, ...props }) => (
      <div className={`p-6 pt-0 ${className}`} {...props}>
        {children}
      </div>
    );

    const Progress = ({ value = 0, max = 100, className = '', indicatorClassName = '' }) => {
      const percentage = Math.min(Math.max((value / max) * 100, 0), 100);
      return (
        <div className={`relative h-4 w-full overflow-hidden rounded-full bg-slate-200 ${className}`}>
          <div
            className={`h-full bg-emerald-500 transition-all duration-500 ease-out ${indicatorClassName}`}
            style={{ width: `${percentage}%` }}
          />
        </div>
      );
    };

    const Badge = ({ variant = 'default', className = '', children, ...props }) => {
      const variants = {
        default: 'bg-slate-900 text-white',
        success: 'bg-emerald-500 text-white',
        warning: 'bg-amber-400 text-slate-900',
        celebrate: 'bg-violet-500 text-white',
      };
      return (
        <span className={`inline-flex items-center rounded-full px-3 py-1 text-sm font-semibold ${variants[variant]} ${className}`} {...props}>
          {children}
        </span>
      );
    };

    const Button = ({ variant = 'default', size = 'default', className = '', children, disabled = false, ...props }) => {
      const variants = {
        default: 'bg-slate-900 text-white hover:bg-slate-800',
        primary: 'bg-emerald-500 text-white hover:bg-emerald-600',
        secondary: 'bg-slate-200 text-slate-900 hover:bg-slate-300',
      };
      const sizeClasses = size === 'lg' ? 'px-8 py-4 text-lg' : 'px-6 py-3 text-base';
      return (
        <button
          className={`inline-flex items-center justify-center rounded-lg font-semibold transition-all active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed ${variants[variant]} ${sizeClasses} ${className}`}
          disabled={disabled}
          {...props}
        >
          {children}
        </button>
      );
    };

    const Icon = ({ name, className = '', size = 24, ...props }) => {
      return <i data-lucide={name} className={className} style={{ width: size, height: size }} {...props}></i>;
    };

    // Event Toast Component
    function EventToast({ event, onDismiss }) {
      useEffect(() => {
        const timer = setTimeout(onDismiss, 3000);
        lucide.createIcons();
        return () => clearTimeout(timer);
      }, [onDismiss]);

      const configs = {
        hard_brake: {
          bg: 'bg-amber-50 border-amber-200',
          icon: 'alert-circle',
          iconColor: 'text-amber-600',
          title: 'Hard Stop Detected'
        },
        sharp_turn: {
          bg: 'bg-blue-50 border-blue-200',
          icon: 'trending-up',
          iconColor: 'text-blue-600',
          title: 'Sharp Turn Detected'
        },
        lane_weaving: {
          bg: 'bg-violet-50 border-violet-200',
          icon: 'activity',
          iconColor: 'text-violet-600',
          title: 'Erratic Motion'
        },
        smooth_driving: {
          bg: 'bg-emerald-50 border-emerald-200',
          icon: 'zap',
          iconColor: 'text-emerald-600',
          title: 'Trip Complete!'
        }
      };

      const config = configs[event.type] || configs.hard_brake;

      return (
        <div className="slide-down fixed top-4 left-4 right-4 z-50 max-w-md mx-auto">
          <div className={`${config.bg} border-2 rounded-lg p-4 shadow-lg shake`}>
            <div className="flex items-start gap-3">
              <Icon name={config.icon} size={24} className={`${config.iconColor} flex-shrink-0`} />
              <div className="flex-1">
                <h3 className="font-semibold text-slate-900">{config.title}</h3>
                <p className="text-sm text-slate-700 mt-1">{event.coaching}</p>
              </div>
              <button onClick={onDismiss} className="text-slate-400 hover:text-slate-600">
                <Icon name="x" size={20} />
              </button>
            </div>
          </div>
        </div>
      );
    }

    // Helper function to calculate distance between GPS coordinates
    function calculateDistance(lat1, lon1, lat2, lon2) {
      const R = 3958.8; // Earth radius in miles
      const dLat = (lat2 - lat1) * Math.PI / 180;
      const dLon = (lon2 - lon1) * Math.PI / 180;
      const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                Math.sin(dLon/2) * Math.sin(dLon/2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
      return R * c;
    }

    // Generate coaching tip based on events
    function generateCoachingTip(eventCounts) {
      if (eventCounts.hardStops >= 2) {
        return "Practice smooth braking by scanning traffic ahead for better flow";
      } else if (eventCounts.turns >= 2) {
        return "Gentle steering creates a more comfortable ride for passengers";
      } else if (eventCounts.weaves >= 1) {
        return "Stay centered in your lane for safety and fuel efficiency";
      } else if (eventCounts.hardStops === 1) {
        return "Almost perfect! One sudden stop - try anticipating traffic changes";
      } else {
        return "Excellent control throughout the trip - keep it up!";
      }
    }

    // Main Dashboard Component
    function SafetyCoachDashboard() {
      // User state (persists across trips)
      const [userXP, setUserXP] = useState(2470);
      const [safeMiles, setSafeMiles] = useState(247);
      const [streak, setStreak] = useState(12);

      // Trip tracking state
      const [isTracking, setIsTracking] = useState(false);
      const [tripScore, setTripScore] = useState(100);
      const [tripDistance, setTripDistance] = useState(0);
      const [tripDuration, setTripDuration] = useState(0);
      const [currentSpeed, setCurrentSpeed] = useState(0);
      const [tripEvents, setTripEvents] = useState([]);
      const [toast, setToast] = useState(null);

      // Sensor state
      const [sensorData, setSensorData] = useState({
        accel: { x: 0, y: 0, z: 0 },
        totalForce: 0,
        heading: 0,
        eventCounts: { hardStops: 0, turns: 0, weaves: 0 }
      });

      // Last trip data
      const [lastTripData, setLastTripData] = useState({
        route: 'Main St â†’ Home',
        time: '2:34 PM',
        distance: 2.5,
        hardBrakes: 2,
        sharpTurns: 0,
        xpEarned: 50,
        tip: 'High traffic zone ahead. Try Route 9 instead for smoother flow!',
        score: 88
      });

      // Refs for sensor tracking
      const lastAcceleration = useRef({ x: 0, y: 0, z: 0 });
      const lastHeading = useRef(0);
      const lastPosition = useRef(null);
      const tripStartTime = useRef(null);
      const gpsWatcher = useRef(null);
      const durationInterval = useRef(null);
      const isCalibrated = useRef(false);
      const calibrationCount = useRef(0);

      // Constants for detection (more sensitive thresholds)
      const MOVEMENT_THRESHOLD = 1.5; // Delta for hard stop
      const TURN_THRESHOLD = 25; // Degrees for sharp turn
      const ROUGH_THRESHOLD = 12; // Force for erratic motion

      const todayMission = {
        title: 'Maintain 3-sec following distance',
        description: 'Keep safe spacing in traffic',
        progress: 4,
        total: 10,
        unit: 'miles'
      };

      const achievements = [
        { id: 1, name: 'Week Warrior', icon: 'ðŸ…', unlocked: true },
        { id: 2, name: 'Smooth Operator', icon: 'ðŸ…', unlocked: true },
        { id: 3, name: 'Distance Master', icon: 'ðŸ…', unlocked: true },
        { id: 4, name: 'Night Owl', icon: 'ðŸ†', unlocked: false },
        { id: 5, name: 'Eco Driver', icon: 'ðŸ†', unlocked: false },
      ];

      useEffect(() => {
        lucide.createIcons();
      }, [isTracking, toast, lastTripData, userXP, safeMiles]);

      // Handle DeviceMotion with delta-based detection
      const handleMotion = (event) => {
        if (!isTracking) return;

        const accel = event.accelerationIncludingGravity;
        if (!accel) return;

        const current = {
          x: accel.x || 0,
          y: accel.y || 0,
          z: accel.z || 0
        };

        // Calibration phase
        if (!isCalibrated.current) {
          calibrationCount.current++;
          if (calibrationCount.current === 1) {
            lastAcceleration.current = current;
          } else if (calibrationCount.current >= 10) {
            isCalibrated.current = true;
          }
          return;
        }

        // Calculate delta (actual movement)
        const deltaX = Math.abs(current.x - lastAcceleration.current.x);
        const deltaY = Math.abs(current.y - lastAcceleration.current.y);
        const deltaZ = Math.abs(current.z - lastAcceleration.current.z);
        const movementDelta = Math.sqrt(deltaX*deltaX + deltaY*deltaY + deltaZ*deltaZ);

        // Calculate total force for display
        const totalForce = Math.sqrt(current.x**2 + current.y**2 + current.z**2);

        // Update sensor data
        setSensorData(prev => ({
          ...prev,
          accel: current,
          totalForce: totalForce
        }));

        // Detect hard stop (sudden change in motion)
        if (movementDelta > MOVEMENT_THRESHOLD) {
          const scoreDeduction = 5;
          setTripScore(prev => Math.max(0, prev - scoreDeduction));
          
          const eventData = {
            type: 'hard_brake',
            coaching: 'In traffic, scan ahead to brake smoothly',
            timestamp: new Date().toLocaleTimeString()
          };
          setToast(eventData);
          setTripEvents(prev => [...prev, eventData]);
          setSensorData(prev => ({
            ...prev,
            eventCounts: { ...prev.eventCounts, hardStops: prev.eventCounts.hardStops + 1 }
          }));
        }

        // Detect erratic motion (phone shake)
        if (totalForce > ROUGH_THRESHOLD) {
          const scoreDeduction = 3;
          setTripScore(prev => Math.max(0, prev - scoreDeduction));
          
          const eventData = {
            type: 'lane_weaving',
            coaching: 'Stay centered in your lane for safety',
            timestamp: new Date().toLocaleTimeString()
          };
          setToast(eventData);
          setTripEvents(prev => [...prev, eventData]);
          setSensorData(prev => ({
            ...prev,
            eventCounts: { ...prev.eventCounts, weaves: prev.eventCounts.weaves + 1 }
          }));
        }

        lastAcceleration.current = current;
      };

      // Handle DeviceOrientation
      const handleOrientation = (event) => {
        if (!isTracking) return;

        const alpha = event.alpha;
        if (alpha === null) return;

        setSensorData(prev => ({ ...prev, heading: alpha }));

        if (lastHeading.current === 0) {
          lastHeading.current = alpha;
          return;
        }

        const headingDelta = Math.abs(alpha - lastHeading.current);
        const normalizedDelta = Math.min(headingDelta, 360 - headingDelta);

        if (normalizedDelta > TURN_THRESHOLD) {
          const direction = (alpha - lastHeading.current > 0) ? 'right' : 'left';
          const scoreDeduction = 4;
          setTripScore(prev => Math.max(0, prev - scoreDeduction));
          
          const eventData = {
            type: 'sharp_turn',
            degrees: normalizedDelta.toFixed(0),
            direction: direction,
            coaching: 'Smooth steering keeps passengers comfortable',
            timestamp: new Date().toLocaleTimeString()
          };
          setToast(eventData);
          setTripEvents(prev => [...prev, eventData]);
          setSensorData(prev => ({
            ...prev,
            eventCounts: { ...prev.eventCounts, turns: prev.eventCounts.turns + 1 }
          }));
        }

        lastHeading.current = alpha;
      };

      // Handle GPS updates
      const handleGPS = (position) => {
        if (!isTracking) return;

        const { latitude, longitude, speed: gpsSpeed } = position.coords;

        // Update speed
        if (gpsSpeed !== null && gpsSpeed >= 0) {
          const speedMph = gpsSpeed * 2.237; // m/s to mph
          setCurrentSpeed(speedMph);
        }

        // Calculate distance
        if (lastPosition.current) {
          const dist = calculateDistance(
            lastPosition.current.latitude,
            lastPosition.current.longitude,
            latitude,
            longitude
          );
          
          if (dist < 0.1) { // Sanity check
            setTripDistance(prev => prev + dist);
          }
        }

        lastPosition.current = { latitude, longitude };
      };

      // Start tracking
      const startTrip = async () => {
        // Request motion permission on iOS
        if (typeof DeviceMotionEvent !== 'undefined' && 
            typeof DeviceMotionEvent.requestPermission === 'function') {
          try {
            const permission = await DeviceMotionEvent.requestPermission();
            if (permission !== 'granted') {
              alert('Motion permission denied. Please allow motion access to track your trip.');
              return;
            }
          } catch (error) {
            console.error('Motion permission error:', error);
            return;
          }
        }

        // Initialize trip
        setIsTracking(true);
        setTripScore(100);
        setTripDistance(0);
        setTripDuration(0);
        setCurrentSpeed(0);
        setTripEvents([]);
        tripStartTime.current = Date.now();
        lastPosition.current = null;
        isCalibrated.current = false;
        calibrationCount.current = 0;
        setSensorData(prev => ({ 
          ...prev, 
          eventCounts: { hardStops: 0, turns: 0, weaves: 0 }
        }));

        // Start sensors
        window.addEventListener('devicemotion', handleMotion);
        window.addEventListener('deviceorientation', handleOrientation);

        // Start GPS tracking
        if (navigator.geolocation) {
          gpsWatcher.current = navigator.geolocation.watchPosition(
            handleGPS,
            (error) => console.error('GPS error:', error),
            { enableHighAccuracy: true, maximumAge: 1000, timeout: 5000 }
          );
        }

        // Update duration
        durationInterval.current = setInterval(() => {
          const duration = (Date.now() - tripStartTime.current) / 1000;
          setTripDuration(duration);
        }, 1000);
      };

      // Stop tracking and update stats
      const stopTrip = () => {
        setIsTracking(false);
        window.removeEventListener('devicemotion', handleMotion);
        window.removeEventListener('deviceorientation', handleOrientation);
        
        if (gpsWatcher.current) {
          navigator.geolocation.clearWatch(gpsWatcher.current);
        }
        
        if (durationInterval.current) {
          clearInterval(durationInterval.current);
        }

        // Calculate final stats
        const xpEarned = Math.floor(tripScore);
        const finalDistance = tripDistance;
        
        // Update last trip data with real information
        setLastTripData({
          route: 'Walking Route',
          time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
          distance: finalDistance,
          hardBrakes: sensorData.eventCounts.hardStops,
          sharpTurns: sensorData.eventCounts.turns,
          xpEarned: xpEarned,
          tip: generateCoachingTip(sensorData.eventCounts),
          score: tripScore
        });

        // Update hero stats with animation
        const newXP = userXP + xpEarned;
        const newMiles = safeMiles + finalDistance;
        
        // Animate updates
        setTimeout(() => {
          setUserXP(newXP);
          setSafeMiles(newMiles);
        }, 500);

        // Show completion toast
        setToast({
          type: 'smooth_driving',
          coaching: `Trip completed! Score: ${tripScore.toFixed(0)}/100. +${xpEarned} XP earned ðŸŽ‰`
        });
      };

      return (
        <div className="min-h-screen bg-gradient-to-b from-slate-50 to-slate-100 pb-32">
          {toast && <EventToast event={toast} onDismiss={() => setToast(null)} />}

          {/* Tracking Status Banner */}
          {isTracking && (
            <div className="fixed top-0 left-0 right-0 bg-emerald-500 text-white py-3 px-4 shadow-lg z-40">
              <div className="max-w-md mx-auto">
                <div className="flex items-center justify-between mb-1">
                  <div className="flex items-center gap-2">
                    <Icon name="activity" size={20} className="animate-pulse" />
                    <span className="font-semibold">Tracking Active</span>
                  </div>
                  <span className="text-sm">{tripDuration.toFixed(0)}s</span>
                </div>
                <div className="flex items-center gap-4 text-sm">
                  <span>Score: {tripScore.toFixed(0)}/100</span>
                  <span>Distance: {tripDistance.toFixed(3)} mi</span>
                  <span>Speed: {currentSpeed.toFixed(1)} mph</span>
                </div>
              </div>
            </div>
          )}

          <div className={`max-w-md mx-auto p-4 space-y-4 ${isTracking ? 'pt-24' : ''}`}>
            
            {/* Hero Stats Card */}
            <Card className="bg-gradient-to-br from-emerald-500 to-emerald-600 text-white border-0 shadow-lg transition-all duration-500">
              <CardContent className="pt-6">
                <div className="flex items-start justify-between mb-4">
                  <div className="flex items-center gap-2">
                    <Icon name="trophy" size={32} />
                    <div>
                      <Badge variant="celebrate" className="mb-1">
                        Gold Streak
                      </Badge>
                      <div className="text-sm opacity-90">Day {streak}</div>
                    </div>
                  </div>
                  <div className="text-right">
                    <div className="text-3xl font-bold">{safeMiles.toFixed(0)}</div>
                    <div className="text-sm opacity-90">safe miles</div>
                  </div>
                </div>
                
                <div className="space-y-2">
                  <div className="flex justify-between text-sm">
                    <span className="opacity-90">Level Progress</span>
                    <span className="font-semibold">{userXP} / 3000 XP</span>
                  </div>
                  <Progress 
                    value={userXP} 
                    max={3000}
                    className="bg-emerald-400/30"
                    indicatorClassName="bg-white"
                  />
                  <div className="text-sm font-medium text-center pt-2">
                    "You're crushing it! ðŸŽ‰"
                  </div>
                </div>
              </CardContent>
            </Card>

            {/* Active Mission Card */}
            <Card className="shadow-md">
              <CardHeader>
                <div className="flex items-center gap-2 text-slate-600 mb-2">
                  <Icon name="target" size={20} />
                  <span className="text-sm font-semibold uppercase tracking-wide">Today's Mission</span>
                </div>
                <CardTitle className="text-xl">{todayMission.title}</CardTitle>
                <p className="text-sm text-slate-600">{todayMission.description}</p>
              </CardHeader>
              <CardContent className="space-y-4">
                <div>
                  <div className="flex justify-between text-sm mb-2">
                    <span className="text-slate-600">Progress</span>
                    <span className="font-semibold">
                      {todayMission.progress} / {todayMission.total} {todayMission.unit}
                    </span>
                  </div>
                  <Progress 
                    value={todayMission.progress} 
                    max={todayMission.total}
                  />
                </div>
                
                <Button 
                  variant={isTracking ? 'secondary' : 'primary'}
                  size="lg"
                  className="w-full"
                  onClick={isTracking ? stopTrip : startTrip}
                >
                  {isTracking ? (
                    <>
                      <Icon name="square" size={20} className="mr-2" />
                      End Trip
                    </>
                  ) : (
                    <>
                      <Icon name="play" size={20} className="mr-2" />
                      Start Tracking
                    </>
                  )}
                </Button>
              </CardContent>
            </Card>

            {/* Latest Trip Insight Card */}
            <Card className="shadow-md">
              <CardHeader>
                <div className="flex items-center justify-between mb-2">
                  <div className="flex items-center gap-2 text-slate-600">
                    <Icon name="car" size={20} />
                    <span className="text-sm font-semibold">Last Trip</span>
                  </div>
                  <span className="text-sm text-slate-500">{lastTripData.time}</span>
                </div>
                <CardTitle className="text-lg">{lastTripData.route}</CardTitle>
                <p className="text-sm text-slate-600">{lastTripData.distance.toFixed(2)} miles</p>
              </CardHeader>
              <CardContent className="space-y-4">
                {/* Events Summary */}
                {(lastTripData.hardBrakes > 0 || lastTripData.sharpTurns > 0) && (
                  <div className="flex items-start gap-3 p-3 rounded-lg bg-amber-50 border border-amber-200">
                    <Icon name="alert-circle" size={20} className="text-amber-600 flex-shrink-0 mt-0.5" />
                    <div className="text-sm">
                      <span className="font-semibold text-amber-900">
                        {lastTripData.hardBrakes > 0 && `${lastTripData.hardBrakes} hard brakes`}
                        {lastTripData.hardBrakes > 0 && lastTripData.sharpTurns > 0 && ', '}
                        {lastTripData.sharpTurns > 0 && `${lastTripData.sharpTurns} sharp turns`}
                        {' detected'}
                      </span>
                      <p className="text-amber-800 mt-1">
                        But hey, you're doing great overall!
                      </p>
                    </div>
                  </div>
                )}
                
                {/* Coaching Tip */}
                <div className="flex items-start gap-3 p-3 rounded-lg bg-violet-50 border border-violet-200">
                  <Icon name="lightbulb" size={20} className="text-violet-600 flex-shrink-0 mt-0.5" />
                  <div className="text-sm">
                    <span className="font-semibold text-violet-900">Pro Tip</span>
                    <p className="text-violet-800 mt-1">{lastTripData.tip}</p>
                  </div>
                </div>
                
                {/* XP Earned */}
                <div className="flex items-center justify-center gap-2 p-4 rounded-lg bg-gradient-to-r from-emerald-500 to-emerald-600 text-white">
                  <Icon name="zap" size={24} />
                  <span className="text-lg font-bold">+{lastTripData.xpEarned} XP earned!</span>
                  <span className="text-2xl">ðŸŽ‰</span>
                </div>

                {/* Trip Score */}
                {lastTripData.score && (
                  <div className="text-center p-3 bg-slate-50 rounded-lg">
                    <div className="text-sm text-slate-600 mb-1">Trip Score</div>
                    <div className="text-3xl font-bold text-emerald-600">{lastTripData.score.toFixed(0)}/100</div>
                  </div>
                )}
              </CardContent>
            </Card>

            {/* Achievement Gallery */}
            <Card className="shadow-md">
              <CardHeader>
                <div className="flex items-center justify-between">
                  <div className="flex items-center gap-2">
                    <Icon name="award" size={20} className="text-slate-600" />
                    <CardTitle className="text-lg">Recent Unlocks</CardTitle>
                  </div>
                  <button className="text-sm text-emerald-600 font-semibold hover:text-emerald-700">
                    View All â†’
                  </button>
                </div>
              </CardHeader>
              <CardContent>
                <div className="flex gap-3 overflow-x-auto pb-2">
                  {achievements.map((achievement) => (
                    <div
                      key={achievement.id}
                      className={`flex-shrink-0 flex flex-col items-center justify-center w-20 h-20 rounded-lg border-2 transition-all ${
                        achievement.unlocked
                          ? 'bg-gradient-to-br from-violet-100 to-violet-50 border-violet-300 shadow-sm'
                          : 'bg-slate-50 border-slate-200 opacity-50'
                      }`}
                    >
                      <span className="text-3xl mb-1">{achievement.icon}</span>
                      {achievement.unlocked && (
                        <span className="text-xs font-semibold text-violet-700">New!</span>
                      )}
                    </div>
                  ))}
                </div>
              </CardContent>
            </Card>

            {/* Footer */}
            <div className="text-center py-6 text-sm text-slate-500">
              <p>Keep up the amazing work! ðŸ’ª</p>
              <p className="mt-1">3 more trips to unlock Silver tier</p>
            </div>
          </div>

          {/* Debug Log - Always visible at bottom when tracking */}
          {isTracking && (
            <div className="fixed bottom-0 left-0 right-0 bg-slate-900 text-white p-3 shadow-2xl z-30">
              <div className="max-w-md mx-auto">
                <div className="flex justify-between items-center mb-2">
                  <span className="text-xs font-semibold text-emerald-400">SENSOR LOG</span>
                  <div className="flex items-center gap-2 text-xs">
                    <div className="w-2 h-2 bg-emerald-400 rounded-full animate-pulse"></div>
                    <span className="text-emerald-400">Live</span>
                  </div>
                </div>
                <div className="font-mono text-xs text-emerald-400 space-y-1">
                  <div>Accel: X={sensorData.accel.x.toFixed(2)} Y={sensorData.accel.y.toFixed(2)} Z={sensorData.accel.z.toFixed(2)}</div>
                  <div>Force: {sensorData.totalForce.toFixed(2)} m/sÂ² | Heading: {sensorData.heading.toFixed(0)}Â°</div>
                  <div className="text-blue-400">Score: {tripScore.toFixed(0)}/100 | Distance: {tripDistance.toFixed(3)}mi | Speed: {currentSpeed.toFixed(1)}mph</div>
                  <div className="text-violet-400">Events: {sensorData.eventCounts.hardStops} stops, {sensorData.eventCounts.turns} turns, {sensorData.eventCounts.weaves} weaves</div>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<SafetyCoachDashboard />);
  </script>
</body>
</html>
